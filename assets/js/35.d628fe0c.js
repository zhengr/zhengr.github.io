(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{425:function(e,t,a){"use strict";a.r(t);var n=a(32),s=Object(n.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"实战zeebe下微服务流程编排"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实战zeebe下微服务流程编排"}},[e._v("#")]),e._v(" 实战Zeebe下微服务流程编排")]),e._v(" "),t("p",[e._v("构建Zeebe作为下一代工作流引擎，用于新兴用例，例如微服务编排用例，这些用例可能需要引擎每秒处理数十万（或数百万）个新工作流实例。为此，我们使用的图形建模标准已经存在了近15年：BPMN（业务流程模型和表示法）。可以预见，未来微服务编排将会是中台服务化最有力的落地工具之一。")]),e._v(" "),t("p",[e._v("借这个机会和大家分享一下基本的Zeebe部署和一个简单的范例。")]),e._v(" "),t("h2",{attrs:{id:"准备环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备环境"}},[e._v("#")]),e._v(" 准备环境")]),e._v(" "),t("h5",{attrs:{id:"_1-先克隆git上的repository获得zeebe-operate-in-docker的文件包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-先克隆git上的repository获得zeebe-operate-in-docker的文件包"}},[e._v("#")]),e._v(" 1.先克隆Git上的repository获得Zeebe + Operate in Docker的文件包")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("git clone https://github.com/zeebe-io/zeebe-docker-compose\n")])])]),t("h5",{attrs:{id:"_2-解压下载的zeebe-docker-compose-master-zip"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-解压下载的zeebe-docker-compose-master-zip"}},[e._v("#")]),e._v(" 2.解压下载的zeebe-docker-compose-master.zip")]),e._v(" "),t("h5",{attrs:{id:"_3-执行基于docker-compose-yml下载并创建相关组件容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-执行基于docker-compose-yml下载并创建相关组件容器"}},[e._v("#")]),e._v(" 3.执行基于docker-compose.yml下载并创建相关组件容器")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# change to directory of the profile to start, i.e\n# cd operate/\ndocker-compose up\n")])])]),t("blockquote",[t("p",[e._v("备注： docker-compose down 用来shutdown容器")])]),e._v(" "),t("p",[e._v("例如：")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("base"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" MacBookPro:operate zhengr$ "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker-compose")]),e._v(" up\n\nPulling operate "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("camunda/operate:1.0.0-alpha11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1.0")]),e._v(".0-alpha11: Pulling from camunda/operate\n\n6f2f362378c5: Pull complete\n\n494c27a8a6b8: Pull complete\n\n7596bb83081b: Pull complete\n\n1e739bce2743: Pull complete\n\n4dde2a90460d: Pull complete\n\n1f5b8585072c: Pull complete\n\n883cfe76ed71: Pull complete\n\nc025c61085ef: Pull complete\n\nb060cd7d08ce: Pull complete\n\n93da9e8063ec: Pull complete\n\nPulling elasticsearch "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("docker.elastic.co/elasticsearch/elasticsearch-oss:6.7.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("6.7")]),e._v(".1: Pulling from elasticsearch/elasticsearch-oss\n\n8ba884070f61: Pull complete\n\n2202e0dee1cc: Pull complete\n\n046487a6b47b: Pull complete\n\n2bf203bafcf4: Pull complete\n\necabf552c89a: Pull complete\n\n93123b7bf511: Pull complete\n\n2867102d5376: Pull complete\n\nPulling zeebe "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("camunda/zeebe:0.18.0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.18")]),e._v(".0: Pulling from camunda/zeebe\n\nde8cd8ac2c2a: Pull complete\n\n62def3ffad8c: Pull complete\n\n1dafe0169f91: Pull complete\n\nf4521a1bc960: Pull complete\n\n0c2a2533a883: Pull complete\n\ndfd212cc6b74: Pull complete\n\n65e222ddee27: Pull complete\n\nce1bf1781edd: Pull complete\n\n4c631900e34b: Pull complete\n\n55bebb03879a: Pull complete\n\n6b22452bf891: Pull complete\n\n8e4a1a2f6114: Pull complete\n\nPulling kibana "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("docker.elastic.co/kibana/kibana-oss:6.7.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("6.7")]),e._v(".1: Pulling from kibana/kibana-oss\n\n8ba884070f61: Already exists\n\n9de755da2607: Pull complete\n\na530113b5366: Pull complete\n\nfcc058e5c07b: Pull complete\n\nb01d58af14f6: Pull complete\n\n74a53cb7bf61: Pull complete\n\n12a05e912a4b: Pull complete\n\n94203c8a1395: Pull complete\n\nCreating operate_kibana_1        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(". "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("done")]),e._v("\n\nCreating operate_elasticsearch_1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(". "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("done")]),e._v("\n\nCreating operate_operate_1       "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(". "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("done")]),e._v("\n\nCreating operate_zeebe_1         "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(". "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("done")]),e._v("\n\nAttaching to operate_kibana_1, operate_operate_1, operate_elasticsearch_1, operate_zeebe_1\n")])])]),t("blockquote",[t("h5",{attrs:{id:"备注"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#备注"}},[e._v("#")]),e._v(" 备注：")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/zhengr/zeebe-docker-compose/blob/master/bin",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("bin/zbctl*")]),t("OutboundLink")],1),e._v(" - cli binary to interact with the broker")])]),e._v(" "),t("h5",{attrs:{id:"服务-端口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务-端口"}},[e._v("#")]),e._v(" 服务 / 端口")]),e._v(" "),t("p",[e._v("我们启动的docker容器将提供如下服务:")]),e._v(" "),t("ul",[t("li",[e._v("Zeebe broker - port 26500")]),e._v(" "),t("li",[e._v("Operate - web interface "),t("a",{attrs:{href:"http://localhost:8080/",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://localhost:8080"),t("OutboundLink")],1),e._v(" (login: demo/demo)")]),e._v(" "),t("li",[e._v("ElasticSearch - port "),t("a",{attrs:{href:"https://localhost:9200/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://localhost:9200"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("Kibana - port "),t("a",{attrs:{href:"https://localhost:5601/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://localhost:5601"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("Simple Monitor - web interface "),t("a",{attrs:{href:"http://localhost:8082/",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://localhost:8082"),t("OutboundLink")],1)])])]),e._v(" "),t("h5",{attrs:{id:"_4-检查服务状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-检查服务状态"}},[e._v("#")]),e._v(" 4.检查服务状态")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("(base) MacBookPro:bin zhengr$ ./zbctl.darwin status\n\nCluster size: 1\n\nPartitions count: 1\n\nReplication factor: 1\n\nBrokers:\n\n  Broker 0 - 172.18.0.5:26501\n\n​    Partition 1 : Leader\n")])])]),t("p",[e._v("以上容器部署完成后， Zeebe的服务框架就准备好了，接下来我们做范例流程部署。")]),e._v(" "),t("h2",{attrs:{id:"流程部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#流程部署"}},[e._v("#")]),e._v(" 流程部署")]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("zbctl")]),e._v(" binary is included to allow you to interact with the running broker. The binary is named:")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("Operating System")]),e._v(" "),t("th",[e._v("zbctl binary")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("Linux")]),e._v(" "),t("td",[e._v("bin/zbctl")])]),e._v(" "),t("tr",[t("td",[e._v("OS X")]),e._v(" "),t("td",[e._v("bin/zbctl.darwin")])]),e._v(" "),t("tr",[t("td",[e._v("Windows")]),e._v(" "),t("td",[e._v("bin/zbctl.exe")])])])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("cd zeebe-docker-compose\nbin/zbctl deploy ../path/to/your-file.bpmn\n")])])]),t("p",[e._v("这里我们用一个已经制作完成的BPMN文件部署测试。"),t("strong",[e._v("order-process.bpmn")])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zhengr/zhengr.github.io/master/assets/images/order-process.png",alt:"order-process"}})]),e._v(" "),t("p",[e._v("这个order-process.bpmn可以用"),t("a",{attrs:{href:"https://github.com/zeebe-io/zeebe-modeler/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("zeebe Modeler"),t("OutboundLink")],1),e._v("可视化编排")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zhengr/zhengr.github.io/master/assets/images/image-20190628115030145.png",alt:"image-20190628115030145"}})]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('(base) MacBookPro:bin zhengr$ ./zbctl.darwin deploy order-process.bpmn\n{\n  "key": 2251799813685259,\n  "workflows": [\n    {\n      "bpmnProcessId": "order-process",\n      "version": 1,\n      "workflowKey": 2251799813685251,\n      "resourceName": "order-process.bpmn"\n    }\n  ]\n}\n')])])]),t("h2",{attrs:{id:"创建流程实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建流程实例"}},[e._v("#")]),e._v(" 创建流程实例")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("./bin/zbctl create instance order-process --variables '{\"orderId\": XXX}'\n")])])]),t("p",[e._v("例如：")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("base"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" MacBookPro:bin zhengr$ ./zbctl.darwin create instance order-process "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--variables")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'{\"orderId\": 45678}'")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"workflowKey"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2251799813685258")]),e._v(",\n\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"bpmnProcessId"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"order-process"')]),e._v(",\n\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"version"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(",\n\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"workflowInstanceKey"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2251799813685260")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),t("p",[e._v("打开 http://localhost:8080 通过Operate检查部署实例情况：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zhengr/zhengr.github.io/master/assets/images/Jietu20190628-122341.jpg",alt:"Jietu20190628-122341"}})]),e._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zhengr/zhengr.github.io/master/assets/images/image-20190628120128229.png",alt:"image-20190628120128229"}})])])}),[],!1,null,null,null);t.default=s.exports}}]);